<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:fragment="head">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title} ?: 'Gestion RH'">Gestion RH</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>

<body>

<!-- Sidebar Fragment -->
<div th:fragment="sidebar" class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div class="logo">RH ÉLÉGANCE</div>
    </div>
    
    <div class="user-info" sec:authorize="isAuthenticated()">
        <i class="fas fa-user-circle"></i>
        <a th:href="@{/profil}" style="text-decoration: none; color: inherit;">
            <h6 sec:authentication="name" style="cursor: pointer; transition: color 0.3s;" onmouseover="this.style.color='#C5A572'" onmouseout="this.style.color='#FFFFFF'">Utilisateur</h6>
        </a>
        <small sec:authentication="principal.authorities">Rôle</small>
    </div>
    
    <nav class="sidebar-nav">
        <a th:href="@{/dashboard}" class="nav-link" th:classappend="${page == 'dashboard'} ? 'active' : ''">
            <i class="fas fa-chart-line"></i>
            <span>Tableau de bord</span>
        </a>
        
        <a th:href="@{/employes/list}" class="nav-link" th:classappend="${page == 'employes'} ? 'active' : ''">
            <i class="fas fa-users"></i>
            <span>Employés</span>
        </a>
        
        <a th:href="@{/departements/list}" class="nav-link" th:classappend="${page == 'departements'} ? 'active' : ''">
            <i class="fas fa-building"></i>
            <span>Départements</span>
        </a>
        
        <a th:href="@{/projets/list}" class="nav-link" th:classappend="${page == 'projets'} ? 'active' : ''">
            <i class="fas fa-project-diagram"></i>
            <span>Projets</span>
        </a>
        
        <a th:href="@{/fiches-paie/list}" class="nav-link" th:classappend="${page == 'fiches-paie'} ? 'active' : ''">
            <i class="fas fa-file-invoice-dollar"></i>
            <span>Fiches de paie</span>
        </a>
        
        <a th:href="@{/conges/list}" class="nav-link" th:classappend="${page == 'conges'} ? 'active' : ''">
            <i class="fas fa-calendar-check"></i>
            <span>Congés</span>
        </a>
        
        <a th:href="@{/statistiques}" class="nav-link" th:classappend="${page == 'statistiques'} ? 'active' : ''"
           sec:authorize="hasAnyRole('ADMIN', 'RH')">
            <i class="fas fa-chart-bar"></i>
            <span>Statistiques</span>
        </a>
        
        <div class="sidebar-divider"></div>
        
        <a th:href="@{/employes/generate-credentials}" class="nav-link" th:classappend="${page == 'generate-credentials'} ? 'active' : ''"
           sec:authorize="hasRole('ADMIN')">
            <i class="fas fa-key"></i>
            <span>Identifiants</span>
        </a>
        
        <div class="sidebar-divider"></div>
        
        <form th:action="@{/logout}" method="post" style="margin: 0;">
            <button type="submit" class="nav-link" style="width: 100%; text-align: left; background: none; border: none; cursor: pointer;">
                <i class="fas fa-sign-out-alt"></i>
                <span>Déconnexion</span>
            </button>
        </form>
    </nav>
</div>

<!-- Topbar Fragment -->
<div th:fragment="topbar" class="topbar">
    <div class="topbar-left">
        <button class="btn btn-link" id="sidebarToggle">
            <i class="fas fa-bars"></i>
        </button>
        <h4 class="topbar-title mb-0" th:text="${pageTitle} ?: 'Gestion RH'">Page</h4>
    </div>
    
    <div class="topbar-right">
        <div class="dropdown">
            <button class="btn btn-link dropdown-toggle" type="button" data-bs-toggle="dropdown">
                <i class="fas fa-user-circle"></i>
                <span sec:authentication="name">Utilisateur</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" th:href="@{/profil}"><i class="fas fa-user"></i> Mon profil</a></li>
                <li><hr class="dropdown-divider"></li>
                <li>
                    <form th:action="@{/logout}" method="post" style="margin: 0;">
                        <button type="submit" class="dropdown-item" style="background: none; border: none; width: 100%; text-align: left; cursor: pointer;">
                            <i class="fas fa-sign-out-alt"></i> Déconnexion
                        </button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- Scripts Fragment -->
<div th:fragment="scripts">
    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery (si nécessaire) -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    
    <!-- Script de sidebar toggle -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.getElementById('sidebar');
            
            if (sidebarToggle && sidebar) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('collapsed');
                });
            }
        });
    </script>
</div>

<!-- Messages Flash Fragment -->
<div th:fragment="messages">
    <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle"></i>
        <span th:text="${message}">Message de succès</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${error}">Message d'erreur</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    
    <div th:if="${warning}" class="alert alert-warning alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle"></i>
        <span th:text="${warning}">Message d'avertissement</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    
    <div th:if="${info}" class="alert alert-info alert-dismissible fade show" role="alert">
        <i class="fas fa-info-circle"></i>
        <span th:text="${info}">Message d'information</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
</div>

<!-- Common Styles Fragment -->
<style th:fragment="common-styles">
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Inter', sans-serif;
        background: #FAFAFA;
        color: #1A1A1A;
        font-size: 14px;
        line-height: 1.6;
    }
    
    .sidebar {
        width: 280px;
        background: #1A1A1A;
        color: #FFFFFF;
        padding: 40px 0;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        z-index: 1000;
    }

    .sidebar-header {
        padding: 0;
        border: none;
    }

    .logo {
        font-family: 'Playfair Display', serif;
        font-size: 28px;
        font-weight: 700;
        color: #C5A572;
        margin-bottom: 48px;
        padding: 0 32px;
        letter-spacing: 1px;
        display: block;
    }

    .logo i {
        display: none;
    }

    .logo h2 {
        display: inline;
        font-family: 'Playfair Display', serif;
        font-size: 28px;
        font-weight: 700;
        color: #C5A572;
        letter-spacing: 1px;
    }

    .user-info {
        background: rgba(197, 165, 114, 0.1);
        border-top: 1px solid rgba(197, 165, 114, 0.2);
        border-bottom: 1px solid rgba(197, 165, 114, 0.2);
        padding: 24px 32px;
        margin-bottom: 32px;
        text-align: center;
    }

    .user-info i {
        font-size: 40px;
        color: #C5A572;
        margin-bottom: 12px;
        display: block;
    }

    .user-info h6 {
        font-size: 16px;
        font-weight: 600;
        color: #FFFFFF;
        margin-bottom: 4px;
        letter-spacing: 0.5px;
    }

    .user-info small {
        font-size: 12px;
        color: #C5A572;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .sidebar-nav {
        padding: 0;
    }
    
    .sidebar-nav .nav-link,
    .sidebar-nav button[type="submit"] {
        display: flex;
        align-items: center;
        padding: 16px 32px;
        color: #B0B0B0;
        text-decoration: none;
        transition: all 0.3s ease;
        font-size: 14px;
        font-weight: 400;
        border-left: 3px solid transparent;
    }

    .sidebar-nav .nav-link i,
    .sidebar-nav button[type="submit"] i {
        width: 24px;
        margin-right: 16px;
        font-size: 16px;
    }

    .sidebar-nav .nav-link:hover,
    .sidebar-nav button[type="submit"]:hover {
        color: #FFFFFF;
        background: rgba(255, 255, 255, 0.05);
    }

    .sidebar-nav .nav-link.active {
        color: #C5A572;
        background: rgba(197, 165, 114, 0.1);
        border-left-color: #C5A572;
        font-weight: 500;
    }

    .sidebar-divider {
        height: 1px;
        background: rgba(255, 255, 255, 0.1);
        margin: 24px 0;
    }
    
    .topbar {
        display: none;
    }
    
    .main-content {
        margin-left: 280px;
        padding: 48px;
        min-height: 100vh;
    }
    
    .card {
        background: #FFFFFF;
        border: 1px solid #E0E0E0;
        padding: 32px;
        margin-bottom: 24px;
        transition: all 0.3s ease;
    }

    .card:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    }
    
    .card-header {
        font-family: 'Playfair Display', serif;
        font-size: 24px;
        font-weight: 600;
        color: #1A1A1A;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid #E0E0E0;
        background: transparent;
        display: flex;
        align-items: center;
    }
    
    .btn {
        display: inline-block;
        padding: 14px 28px;
        font-size: 13px;
        font-weight: 500;
        text-decoration: none;
        transition: all 0.3s ease;
        border: 1px solid #1A1A1A;
        cursor: pointer;
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-family: 'Inter', sans-serif;
    }
    
    .btn-primary {
        background: #1A1A1A;
        color: #C5A572;
        border-color: #1A1A1A;
    }
    
    .btn-primary:hover {
        background: #C5A572;
        color: #1A1A1A;
        border-color: #C5A572;
    }
    
    .btn-secondary {
        background: transparent;
        color: #1A1A1A;
        border: 1px solid #E0E0E0;
    }

    .btn-secondary:hover {
        background: #1A1A1A;
        color: #FFFFFF;
        border-color: #1A1A1A;
    }

    .btn-outline {
        background: transparent;
        color: #C5A572;
        border: 1px solid #C5A572;
    }

    .btn-outline:hover {
        background: #C5A572;
        color: #1A1A1A;
    }

    .btn-danger {
        background: transparent;
        color: #DC3545;
        border: 1px solid #DC3545;
    }

    .btn-danger:hover {
        background: #DC3545;
        color: #FFFFFF;
        border-color: #DC3545;
    }

    .btn-sm {
        padding: 8px 16px;
        font-size: 13px;
        min-width: auto;
    }
    
    .table {
        background: white;
    }
    
    .table thead th {
        background: #FAFAFA;
        color: #1A1A1A;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-weight: 600;
        padding: 16px;
        border-bottom: 2px solid #E0E0E0;
    }

    .table tbody td {
        padding: 20px 16px;
        border-bottom: 1px solid #F5F5F5;
        color: #1A1A1A;
        font-size: 14px;
    }

    .table tbody tr {
        transition: background 0.2s ease;
    }

    .table tbody tr:hover {
        background: #FAFAFA;
    }
    
    .badge {
        display: inline-block;
        padding: 6px 14px;
        font-size: 11px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 1px;
        border: 1px solid;
    }

    .badge-success {
        background: rgba(197, 165, 114, 0.1);
        color: #C5A572;
        border-color: #C5A572;
    }

    .badge-warning {
        background: rgba(0, 0, 0, 0.05);
        color: #666666;
        border-color: #E0E0E0;
    }

    .badge-danger {
        background: rgba(0, 0, 0, 0.1);
        color: #1A1A1A;
        border-color: #1A1A1A;
    }

    .badge-info {
        background: transparent;
        color: #999999;
        border-color: #E0E0E0;
    }

    .alert {
        padding: 20px 24px;
        margin-bottom: 24px;
        border-left: 3px solid;
        background: #FAFAFA;
        border-radius: 0;
    }

    .alert-success {
        border-left-color: #22C55E;
        background: #F0FDF4;
        color: #166534;
        border-left-width: 5px;
    }

    .alert-danger {
        border-left-color: #1A1A1A;
        color: #1A1A1A;
        background: #FAFAFA;
    }

    .alert-warning {
        border-left-color: #666666;
        color: #1A1A1A;
        background: #FAFAFA;
    }

    .alert-info {
        border-left-color: #E0E0E0;
        color: #666666;
        background: #FAFAFA;
    }

    /* Styles additionnels pour correspondre au projet final */
    .header {
        margin-bottom: 48px;
        border-bottom: 1px solid #E0E0E0;
        padding-bottom: 24px;
    }

    .header h1 {
        font-family: 'Playfair Display', serif;
        font-size: 42px;
        font-weight: 700;
        color: #1A1A1A;
        margin-bottom: 8px;
        letter-spacing: -1px;
    }

    .header .subtitle {
        font-size: 16px;
        color: #666666;
        font-weight: 300;
    }

    .form-group {
        margin-bottom: 24px;
    }

    .form-label {
        display: block;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-weight: 600;
        color: #1A1A1A;
        margin-bottom: 8px;
    }

    .form-control {
        width: 100%;
        padding: 14px 16px;
        font-size: 14px;
        font-family: 'Inter', sans-serif;
        border: 1px solid #E0E0E0;
        background: #FFFFFF;
        color: #1A1A1A;
        transition: all 0.3s ease;
    }

    .form-control:focus {
        outline: none;
        border-color: #C5A572;
        box-shadow: 0 0 0 3px rgba(197, 165, 114, 0.1);
    }

    .form-control::placeholder {
        color: #999999;
        font-weight: 300;
    }

    textarea.form-control {
        resize: vertical;
        min-height: 120px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 24px;
        margin-bottom: 48px;
    }

    .stat-card {
        background: #FFFFFF;
        border: 1px solid #E0E0E0;
        padding: 32px 24px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: #C5A572;
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .stat-card:hover::before {
        transform: scaleX(1);
    }

    .stat-card:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        transform: translateY(-4px);
    }

    .stat-card i {
        font-size: 24px;
        color: #C5A572;
        margin-bottom: 16px;
    }

    .stat-card h4 {
        font-size: 36px;
        font-weight: 300;
        color: #1A1A1A;
        margin-bottom: 8px;
    }

    .stat-card p {
        font-size: 11px;
        color: #666666;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-weight: 500;
        margin: 0;
    }

    .grid-2 {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
    }

    .grid-3 {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 24px;
    }

    .text-muted {
        color: #999999 !important;
    }

    .text-accent {
        color: #C5A572 !important;
    }

    .divider {
        height: 1px;
        background: #E0E0E0;
        margin: 32px 0;
    }

    /* Avatar styles */
    .avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: #C5A572;
        color: #1A1A1A;
        font-weight: 600;
        font-size: 16px;
        text-transform: uppercase;
    }

    .avatar-lg {
        width: 80px;
        height: 80px;
        font-size: 28px;
    }

    /* Button icon styles */
    .btn-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 4px;
        background: transparent;
        border: 1px solid #E0E0E0;
        color: #666666;
        transition: all 0.3s ease;
        cursor: pointer;
        text-decoration: none;
    }

    .btn-icon:hover {
        background: #C5A572;
        border-color: #C5A572;
        color: #1A1A1A;
    }

    .btn-icon.btn-danger {
        border-color: #DC3545;
        color: #DC3545;
    }

    .btn-icon.btn-danger:hover {
        background: #DC3545;
        color: #FFFFFF;
    }

    /* Badge elegant styles */
    .badge-elegant {
        display: inline-block;
        padding: 6px 14px;
        font-size: 11px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 1px;
        border: 1px solid;
        border-radius: 0;
    }

    .badge-elegant.badge-success {
        background: rgba(197, 165, 114, 0.1);
        color: #C5A572;
        border-color: #C5A572;
    }

    .badge-elegant.badge-warning {
        background: rgba(0, 0, 0, 0.05);
        color: #666666;
        border-color: #E0E0E0;
    }

    .badge-elegant.badge-danger {
        background: rgba(0, 0, 0, 0.1);
        color: #1A1A1A;
        border-color: #1A1A1A;
    }

    .badge-elegant.badge-info {
        background: transparent;
        color: #999999;
        border-color: #E0E0E0;
    }

    .badge-elegant.badge-secondary {
        background: rgba(0, 0, 0, 0.05);
        color: #666666;
        border-color: #E0E0E0;
    }

    /* Table elegant styles */
    .table-elegant {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }

    .table-elegant thead th {
        background: #FAFAFA;
        color: #1A1A1A;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-weight: 600;
        padding: 16px;
        border-bottom: 2px solid #E0E0E0;
        text-align: left;
    }

    .table-elegant tbody td {
        padding: 20px 16px;
        border-bottom: 1px solid #F5F5F5;
        color: #1A1A1A;
        font-size: 14px;
    }

    .table-elegant tbody tr {
        transition: background 0.2s ease;
    }

    .table-elegant tbody tr:hover {
        background: #FAFAFA;
    }

    @media (max-width: 1024px) {
        .sidebar {
            width: 240px;
        }
        .main-content {
            margin-left: 240px;
        }
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
        }
        .main-content {
            margin-left: 0;
            padding: 24px;
        }
        .stats-grid {
            grid-template-columns: 1fr;
        }
        .grid-2, .grid-3 {
            grid-template-columns: 1fr;
        }
    }
</style>

</body>
</html>
