<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}" lang="fr">
<head>
    <title>Mon Profil - RH Élégance</title>
</head>
<body>
<div layout:fragment="content">
    <div class="header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1 style="margin-bottom: 8px;">Mon Profil</h1>
                <p class="subtitle">Consultez vos informations personnelles et professionnelles</p>
            </div>
        </div>
    </div>

    <div th:if="${error}" class="alert alert-danger" role="alert">
        <i class="fas fa-exclamation-circle" style="margin-right: 8px;"></i>
        <span th:text="${error}"></span>
    </div>

    <div th:if="${success}" class="alert alert-success" role="alert">
        <i class="fas fa-check-circle" style="margin-right: 8px;"></i>
        <span th:text="${success}"></span>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 24px;">
        <!-- Carte Utilisateur -->
        <div class="card">
            <div class="card-header">
                <i class="fas fa-user-circle" style="margin-right: 12px;"></i>Compte Utilisateur
            </div>
            <div style="padding: 32px; text-align: center;">
                <div style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, #C5A572 0%, #A08555 100%); display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; font-size: 48px; color: white; font-weight: 700;"
                     th:text="${#strings.substring(#authentication.name, 0, 1).toUpperCase()}">
                    A
                </div>
                
                <h3 style="font-family: 'Playfair Display', serif; font-size: 24px; margin-bottom: 8px; color: #1A1A1A;"
                    th:text="${#authentication.name}">
                    admin
                </h3>
                
                <div style="display: inline-block; padding: 8px 16px; background: #C5A572; color: white; border-radius: 4px; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 24px;"
                     th:text="${#authorization.expression('hasRole(''ADMIN'')') ? 'Administrateur' : (#authorization.expression('hasRole(''RH'')') ? 'Ressources Humaines' : 'Employé')}">
                    ADMIN
                </div>
                
                <div style="padding: 16px; background: #F5F5F5; border-radius: 8px; margin-top: 24px;">
                    <div style="margin-bottom: 12px;">
                        <label class="form-label">NOM D'UTILISATEUR</label>
                        <p style="font-size: 14px; color: #1A1A1A; font-weight: 600;"
                           th:text="${#authentication.name}">
                            admin
                        </p>
                    </div>
                    <div>
                        <label class="form-label">RÔLE</label>
                        <p style="font-size: 14px; color: #1A1A1A; font-weight: 600;"
                           th:text="${#authorization.expression('hasRole(''ADMIN'')') ? 'Administrateur' : (#authorization.expression('hasRole(''RH'')') ? 'RH' : 'Employé')}">
                            Administrateur
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Informations Employé -->
        <div th:if="${employe != null}">
            <div class="card" style="margin-bottom: 24px;">
                <div class="card-header">
                    <i class="fas fa-id-card" style="margin-right: 12px;"></i>Informations Personnelles
                </div>
                <div style="padding: 32px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <div>
                            <label class="form-label">MATRICULE</label>
                            <p style="font-family: 'Courier New', monospace; font-size: 18px; color: #C5A572; font-weight: 600;"
                               th:text="${employe.matricule}">
                                EMP001
                            </p>
                        </div>
                        
                        <div>
                            <label class="form-label">NOM COMPLET</label>
                            <p style="font-size: 16px; color: #1A1A1A; font-weight: 600;"
                               th:text="${employe.prenom + ' ' + employe.nom}">
                                Jean Dupont
                            </p>
                        </div>
                        
                        <div>
                            <label class="form-label">EMAIL</label>
                            <p style="font-size: 14px; color: #1A1A1A;">
                                <i class="fas fa-envelope" style="color: #C5A572; margin-right: 8px;"></i>
                                <a th:href="'mailto:' + ${employe.email}" 
                                   style="color: #1A1A1A; text-decoration: none;"
                                   th:text="${employe.email}">
                                    jean.dupont@example.com
                                </a>
                            </p>
                        </div>
                        
                        <div>
                            <label class="form-label">TÉLÉPHONE</label>
                            <p style="font-size: 14px; color: #1A1A1A;">
                                <i class="fas fa-phone" style="color: #C5A572; margin-right: 8px;"></i>
                                <span th:text="${employe.telephone}">0612345678</span>
                            </p>
                        </div>
                        
                        <div style="grid-column: 1 / -1;">
                            <label class="form-label">ADRESSE</label>
                            <p style="font-size: 14px; color: #1A1A1A; line-height: 1.6;">
                                <i class="fas fa-map-marker-alt" style="color: #C5A572; margin-right: 8px;"></i>
                                <span th:text="${employe.adresse}">Adresse</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-briefcase" style="margin-right: 12px;"></i>Informations Professionnelles
                </div>
                <div style="padding: 32px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <div>
                            <label class="form-label">POSTE</label>
                            <p style="font-size: 16px; color: #1A1A1A; font-weight: 600;"
                               th:text="${employe.poste}">
                                Développeur
                            </p>
                        </div>
                        
                        <div>
                            <label class="form-label">GRADE</label>
                            <p style="font-size: 16px; color: #1A1A1A; font-weight: 600;"
                               th:text="${employe.grade}">
                                SENIOR
                            </p>
                        </div>
                        
                        <div>
                            <label class="form-label">DÉPARTEMENT</label>
                            <p style="font-size: 14px; color: #1A1A1A;">
                                <a th:if="${employe.departement != null}"
                                   th:href="@{/departements/show/{id}(id=${employe.departement.id})}"
                                   style="color: #C5A572; text-decoration: none;"
                                   th:text="${employe.departement.nom}">
                                    IT
                                </a>
                                <span th:unless="${employe.departement != null}" style="color: #999999;">Aucun département</span>
                            </p>
                        </div>
                        
                        <div>
                            <label class="form-label">STATUT</label>
                            <p>
                                <span class="badge-elegant badge-success" th:if="${employe.statut.name() == 'ACTIF'}">Actif</span>
                                <span class="badge-elegant badge-secondary" th:unless="${employe.statut.name() == 'ACTIF'}"
                                      th:text="${employe.statut.libelle}">
                                </span>
                            </p>
                        </div>
                        
                        <div>
                            <label class="form-label">DATE D'EMBAUCHE</label>
                            <p style="font-size: 14px; color: #1A1A1A;"
                               th:text="${#temporals.format(employe.dateEmbauche, 'dd/MM/yyyy')}">
                                01/01/2020
                            </p>
                        </div>
                        
                        <div>
                            <label class="form-label">ANCIENNETÉ</label>
                            <p style="font-size: 14px; color: #1A1A1A; font-weight: 600;"
                               th:text="${employe.anciennete} + ' ans'">
                                5 ans
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Changer le mot de passe -->
            <div class="card" style="margin-top: 24px;">
                <div class="card-header">
                    <i class="fas fa-key" style="margin-right: 12px;"></i>Modifier le mot de passe
                </div>
                <div style="padding: 32px;">
                    <form th:action="@{/profil/change-password}" method="post" th:object="${passwordForm}">
                        <div style="margin-bottom: 24px;">
                            <label for="currentPassword" class="form-label">MOT DE PASSE ACTUEL</label>
                            <input type="password" 
                                   id="currentPassword" 
                                   th:field="*{currentPassword}"
                                   class="form-control"
                                   placeholder="Entrez votre mot de passe actuel"
                                   required>
                            <div class="error-message" th:if="${#fields.hasErrors('currentPassword')}" th:errors="*{currentPassword}"></div>
                        </div>
                        
                        <div style="margin-bottom: 24px;">
                            <label for="newPassword" class="form-label">NOUVEAU MOT DE PASSE</label>
                            <input type="password" 
                                   id="newPassword" 
                                   th:field="*{newPassword}"
                                   class="form-control"
                                   placeholder="Entrez le nouveau mot de passe (min. 6 caractères)"
                                   minlength="6"
                                   required>
                            <div class="error-message" th:if="${#fields.hasErrors('newPassword')}" th:errors="*{newPassword}"></div>
                        </div>
                        
                        <div style="margin-bottom: 24px;">
                            <label for="confirmPassword" class="form-label">CONFIRMER LE MOT DE PASSE</label>
                            <input type="password" 
                                   id="confirmPassword" 
                                   th:field="*{confirmPassword}"
                                   class="form-control"
                                   placeholder="Confirmez le nouveau mot de passe"
                                   minlength="6"
                                   required>
                            <div class="error-message" th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}"></div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save" style="margin-right: 8px;"></i>Modifier le mot de passe
                        </button>
                    </form>
                </div>
            </div>

            <!-- Boutons d'action -->
            <div style="margin-top: 24px; display: flex; gap: 12px;">
                <a th:href="@{/employes/show/{id}(id=${employe.id})}" class="btn btn-primary">
                    <i class="fas fa-eye" style="margin-right: 8px;"></i>Voir mon profil complet
                </a>
                <a th:href="@{/conges/list}" class="btn btn-secondary">
                    <i class="fas fa-calendar-alt" style="margin-right: 8px;"></i>Mes congés
                </a>
                <a th:href="@{/fiches-paie/list}" class="btn btn-secondary">
                    <i class="fas fa-file-invoice-dollar" style="margin-right: 8px;"></i>Mes fiches de paie
                </a>
            </div>
        </div>

        <div th:if="${employe == null}">
            <div class="card" style="margin-bottom: 24px;">
                <div style="padding: 60px 40px; text-align: center;">
                    <i class="fas fa-user-slash" style="font-size: 48px; color: #E0E0E0; margin-bottom: 16px;"></i>
                    <h3 style="font-family: 'Playfair Display', serif; font-size: 24px; margin-bottom: 12px;">
                        Aucun employé associé
                    </h3>
                    <p style="color: #666666; margin-bottom: 24px;">
                        Votre compte utilisateur n'est pas encore lié à une fiche employé.
                    </p>
                    <p style="font-size: 12px; color: #999999;">
                        Contactez le service RH pour plus d'informations.
                    </p>
                </div>
            </div>
            
            <!-- Changer le mot de passe (pour utilisateurs sans employé) -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-key" style="margin-right: 12px;"></i>Modifier le mot de passe
                </div>
                <div style="padding: 32px;">
                    <form th:action="@{/profil/change-password}" method="post" th:object="${passwordForm}">
                        <div style="margin-bottom: 24px;">
                            <label for="currentPassword2" class="form-label">MOT DE PASSE ACTUEL</label>
                            <input type="password" 
                                   id="currentPassword2" 
                                   th:field="*{currentPassword}"
                                   class="form-control"
                                   placeholder="Entrez votre mot de passe actuel"
                                   required>
                            <div class="error-message" th:if="${#fields.hasErrors('currentPassword')}" th:errors="*{currentPassword}"></div>
                        </div>
                        
                        <div style="margin-bottom: 24px;">
                            <label for="newPassword2" class="form-label">NOUVEAU MOT DE PASSE</label>
                            <input type="password" 
                                   id="newPassword2" 
                                   th:field="*{newPassword}"
                                   class="form-control"
                                   placeholder="Entrez le nouveau mot de passe (min. 6 caractères)"
                                   minlength="6"
                                   required>
                            <div class="error-message" th:if="${#fields.hasErrors('newPassword')}" th:errors="*{newPassword}"></div>
                        </div>
                        
                        <div style="margin-bottom: 24px;">
                            <label for="confirmPassword2" class="form-label">CONFIRMER LE MOT DE PASSE</label>
                            <input type="password" 
                                   id="confirmPassword2" 
                                   th:field="*{confirmPassword}"
                                   class="form-control"
                                   placeholder="Confirmez le nouveau mot de passe"
                                   minlength="6"
                                   required>
                            <div class="error-message" th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}"></div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save" style="margin-right: 8px;"></i>Modifier le mot de passe
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
