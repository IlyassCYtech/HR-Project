<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{layout/main :: layout(~{::title}, ~{::content})}">
<head>
    <title>Gestion des Employés - Système RH</title>
</head>
<body>
<div th:fragment="content">
    <div class="header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1>Gestion des Employés</h1>
                <p class="subtitle">Liste complète et recherche avancée</p>
            </div>
            <div style="display: flex; gap: 12px;" sec:authorize="hasAnyRole('ADMIN', 'RH')">
                <a th:href="@{/employes/generate-credentials}" class="btn btn-secondary">
                    <i class="fas fa-key" style="margin-right: 8px;"></i>Générer identifiants
                </a>
                <a th:href="@{/employes/new}" class="btn btn-primary">
                    <i class="fas fa-user-plus" style="margin-right: 8px;"></i>Nouvel employé
                </a>
            </div>
        </div>
    </div>

    <!-- Messages -->
    <div th:if="${error}" class="alert alert-danger">
        <i class="fas fa-exclamation-circle" style="margin-right: 8px;"></i><span th:text="${error}">Erreur</span>
    </div>

    <div th:if="${success}" class="alert alert-success">
        <i class="fas fa-check-circle" style="margin-right: 8px;"></i><span th:text="${success}">Succès</span>
    </div>

    <!-- Filtres de recherche -->
    <div class="card" style="margin-bottom: 24px;">
        <div class="card-header">
            <i class="fas fa-filter" style="margin-right: 12px;"></i>Filtres de recherche
        </div>

        <form method="GET" th:action="@{/employes}">
            <div class="grid-3" style="padding: 0 32px; margin-top: 24px;">
                <div class="form-group">
                    <label class="form-label">Nom / Prénom</label>
                    <input type="text" class="form-control" name="search" th:value="${currentSearch}" placeholder="Rechercher...">
                </div>

                <div class="form-group">
                    <label class="form-label">Matricule</label>
                    <input type="text" class="form-control" name="matricule" th:value="${currentMatricule}" placeholder="Ex: EMP001">
                </div>

                <div class="form-group">
                    <label class="form-label">Département</label>
                    <select class="form-control" name="departement">
                        <option value="">Tous les départements</option>
                        <option th:each="dept : ${departements}" 
                                th:value="${dept.id}" 
                                th:text="${dept.nom}"
                                th:selected="${currentDepartement != null and currentDepartement == dept.id}">
                            Département
                        </option>
                    </select>
                </div>
            </div>

            <div class="grid-3" style="padding: 0 32px; margin-bottom: 24px;">
                <div class="form-group">
                    <label class="form-label">Poste</label>
                    <input type="text" class="form-control" name="poste" th:value="${currentPoste}" placeholder="Ex: Développeur">
                </div>

                <div class="form-group">
                    <label class="form-label">Grade</label>
                    <select class="form-control" name="grade">
                        <option value="">Tous les grades</option>
                        <option value="STAGIAIRE" th:selected="${currentGrade == 'STAGIAIRE'}">Stagiaire</option>
                        <option value="JUNIOR" th:selected="${currentGrade == 'JUNIOR'}">Junior</option>
                        <option value="SENIOR" th:selected="${currentGrade == 'SENIOR'}">Senior</option>
                        <option value="EXPERT" th:selected="${currentGrade == 'EXPERT'}">Expert</option>
                        <option value="MANAGER" th:selected="${currentGrade == 'MANAGER'}">Manager</option>
                        <option value="DIRECTEUR" th:selected="${currentGrade == 'DIRECTEUR'}">Directeur</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Statut</label>
                    <select class="form-control" name="statut">
                        <option value="">Tous les statuts</option>
                        <option value="ACTIF" th:selected="${currentStatut == 'ACTIF'}">Actif</option>
                        <option value="SUSPENDU" th:selected="${currentStatut == 'SUSPENDU'}">Suspendu</option>
                        <option value="DEMISSION" th:selected="${currentStatut == 'DEMISSION'}">Démission</option>
                        <option value="LICENCIE" th:selected="${currentStatut == 'LICENCIE'}">Licencié</option>
                        <option value="RETRAITE" th:selected="${currentStatut == 'RETRAITE'}">Retraité</option>
                    </select>
                </div>
            </div>

            <div style="padding: 0 32px 32px; display: flex; gap: 12px;">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search" style="margin-right: 8px;"></i>Rechercher
                </button>
                <a th:href="@{/employes}" class="btn btn-secondary">
                    <i class="fas fa-times" style="margin-right: 8px;"></i>Réinitialiser
                </a>
            </div>
        </form>
    </div>

    <!-- Liste des employés -->
    <div class="card">
        <div class="card-header">
            <i class="fas fa-list" style="margin-right: 12px;"></i>
            Liste des employés
            <span class="badge-elegant badge-info" style="margin-left: 12px;" th:text="${employes != null ? employes.size() : 0} + ' résultats'">0 résultats</span>
        </div>

        <div th:if="${employes == null or employes.isEmpty()}" style="text-align: center; padding: 80px 32px; color: #999999;">
            <i class="fas fa-users" style="font-size: 64px; margin-bottom: 24px; color: #E0E0E0;"></i>
            <p style="font-size: 16px; font-weight: 300;">Aucun employé trouvé</p>
            <p style="font-size: 13px;">Essayez de modifier vos critères de recherche</p>
        </div>

        <div th:if="${employes != null and !employes.isEmpty()}" style="overflow-x: auto;">
            <table class="table-elegant">
                <thead>
                    <tr>
                        <th>Matricule</th>
                        <th>Employé</th>
                        <th>Email</th>
                        <th>Département</th>
                        <th>Poste</th>
                        <th>Grade</th>
                        <th>Statut</th>
                        <th style="text-align: right;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="employe : ${employes}">
                        <td>
                            <strong style="font-family: 'Courier New', monospace; color: #C5A572;" th:text="${employe.matricule}">
                                MAT001
                            </strong>
                        </td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div class="avatar" th:text="${#strings.substring(employe.prenom, 0, 1) + #strings.substring(employe.nom, 0, 1)}">
                                    AB
                                </div>
                                <div>
                                    <div style="font-weight: 600; color: #1A1A1A;" th:text="${employe.prenom + ' ' + employe.nom}">
                                        Jean Dupont
                                    </div>
                                    <div style="font-size: 12px; color: #999999;" th:text="${employe.telephone}">
                                        0612345678
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <a th:if="${employe.email != null and !employe.email.isEmpty()}" 
                               th:href="'mailto:' + ${employe.email}" 
                               style="color: #C5A572; text-decoration: none;"
                               th:text="${employe.email}">
                                email@example.com
                            </a>
                        </td>
                        <td>
                            <span th:if="${employe.departement != null}" class="badge-elegant badge-info" th:text="${employe.departement.nom}">
                                Département
                            </span>
                        </td>
                        <td th:text="${employe.poste}">Poste</td>
                        <td>
                            <span style="font-size: 12px; color: #666666;" th:text="${employe.grade}">
                                JUNIOR
                            </span>
                        </td>
                        <td>
                            <span th:switch="${employe.statut.name()}">
                                <span th:case="'ACTIF'" class="badge-elegant badge-success">Actif</span>
                                <span th:case="'SUSPENDU'" class="badge-elegant badge-warning">Suspendu</span>
                                <span th:case="'DEMISSIONNAIRE'" class="badge-elegant badge-info">Démission</span>
                                <span th:case="'LICENCIE'" class="badge-elegant badge-danger">Licencié</span>
                                <span th:case="'RETRAITE'" class="badge-elegant badge-info">Retraité</span>
                                <span th:case="*" class="badge-elegant badge-warning" th:text="${employe.statut}">Statut</span>
                            </span>
                        </td>
                        <td style="text-align: right; white-space: nowrap;">
                            <a th:href="@{/employes/{id}(id=${employe.id})}" 
                               class="btn btn-outline" 
                               style="padding: 8px 12px; margin-right: 4px;"
                               title="Voir les détails">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a th:href="@{/employes/{id}/edit(id=${employe.id})}" 
                               class="btn btn-secondary" 
                               style="padding: 8px 12px; margin-right: 4px;"
                               title="Modifier"
                               sec:authorize="hasAnyRole('ADMIN', 'RH')">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a th:if="${employe.statut.name() == 'ACTIF'}"
                               th:href="@{/employes/{id}/delete(id=${employe.id})}" 
                               class="btn btn-secondary" 
                               style="padding: 8px 12px;"
                               title="Désactiver"
                               sec:authorize="hasAnyRole('ADMIN', 'RH')"
                               th:attr="onclick='return confirm(\'Êtes-vous sûr de vouloir désactiver ' + ${employe.prenom + ' ' + employe.nom} + ' ?\');'">
                                <i class="fas fa-user-times"></i>
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
</html>
